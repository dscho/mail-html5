<div class="mail-list" ng-controller="MailListCtrl">

  <header>
    <button class="btn-navicon" wo-touch="state.nav.toggle(true); $event.stopPropagation()">
      <svg><use xlink:href="#icon-navicon" /><title>Toggle Navigation</title></svg>
    </button>
    <h2>{{state.nav.currentFolder.type}}</h2>

    <button class="btn-icon" title="New mail" wo-touch="state.writer.write(); $event.stopPropagation()">
      <svg><use xlink:href="#icon-write" /><title>New mail</title></svg>
    </button>

    <div class="search">
      <svg><use xlink:href="#icon-search" /><title>Search</title></svg>
      <input class="input-text" type="text" ng-model="searchText"
        ng-change="displaySearchResults(searchText)"
        placeholder="Search" focus-me="state.mailList.searching">
    </div>
  </header>

  <div class="mail-list__scroll-canvas" list-scroll="displayMessages">
    <ul class="foo-mail-list" infinite-scroll="displayMore()"
      infinite-scroll-distance="1" infinite-scroll-parent="true">
      <li ng-class="{'mail-list-active': email === state.mailList.selected}"
        wo-touch="select(email)"
        ng-repeat="email in displayMessages">
        <h3>{{email.from[0].name || email.from[0].address}}</h3>
        <svg class="encrypted" ng-show="email.encrypted && !email.decrypted"><use xlink:href="#icon-encrypted" /><title>Encrypted</title></svg>
        <svg class="encrypted" ng-show="email.encrypted && email.decrypted"><use xlink:href="#icon-decrypted" /><title>Decrypted</title></svg>
        <div class="head">
          <p class="subject">{{email.subject || 'No subject'}}</p>
          <time>{{email.sentDate | date:'mediumDate'}}</time>
        </div>
        <p class="body">{{email.body ? email.body.substr(0, 200) : ''}}</p>
        <ul class="flags">
          <li ng-show="email.unread"></li>
          <li ng-show="!email.unread && email.answered">
            <svg><use xlink:href="#icon-reply" /><title>Answered</title></svg>
          </li>
          <li ng-show="email.attachments !== undefined && email.attachments.length > 0">
            <svg><use xlink:href="#icon-attachment" /><title>Attachments</title></svg>
          </li>
        </ul>
      </li>
    </ul>
  </div>

  <footer>
    <span class="spinner" ng-show="account.loggingIn || account.busy || searching"></span>
    <span class="text" ng-switch="account.online">
      <span ng-switch-when="false">
        <svg><use xlink:href="#icon-offline" /></svg>
      </span>
      {{lastUpdateLbl}} {{lastUpdate | date:'shortTime'}}
    </span>
  </footer>
</div>